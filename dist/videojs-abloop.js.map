{"version":3,"sources":["videojs-abloop.js","plugin.js"],"names":["window","videojs","version","abLoopPlugin","initialOptions","player","isNumber","n","isNaN","parseFloat","isFinite","isFunction","functionToCheck","getType","toString","call","toBoolean","x","cloneAndPluck","sourceObject","keys","newObject","forEach","key","undefined","formatTimeWithMS","seconds","decimalPlaces","formatTime","Math","floor","pow","roundFloat","f","parseTimeStamp","timestamp","test","res","exec","d","match","sign","hours","mins","secs","multiplier","totSecs","opts","optionSpecs","duration","callBackSpecs","optionNames","Object","callBackNames","defaultInitialOptions","setToDefault","specs","name","default","setCallBacksToInitialOptions","callBackName","check","api","validateOptions","optName","validate","setOptionsToInitialOptions","setOptions","newOptions","replaceAll","alreadyPausedBeforeLoop","goToStartOfLoop","checkPause","pauseBeforeLooping","pause","currentTime","start","pauseAfterLooping","onLoopCallBack","goToEndOfLoop","end","timeSetter","time","timeAdjuster","adjustment","playLoop","enableLoop","play","enabled","disableLoop","cyclePauseOnLooping","after","before","toggler","absoluteURL","url","document","div","createElement","innerHTML","firstChild","href","getAbsoluteUrlWithHash","spec","getUrlWithHash","getUrlHash","hash","src","currentSrc","applyUrlHash","parseUrl","re","replace","applyUrl","urlWithoutHash","urlHash","curSrc","getOptions","optionsToReturn","retOpts","Array","isArray","notify","funcToRun","changed","defValue","args","arguments","oldOpts","ret","apply","optionDetails","onOptionsChange","updateButtonText","loopAtEndOfVideoRequired","startMargin","endMargin","loopRequired","curTime","endTime","startTime","getEndTime","getStartTime","loopIfAfterEnd","loopIfBeforeStart","isLooping","minLoopLength","checkABLoop","e","paused","setTimeout","buttons","buttonSpecs","event","shiftKey","adjustStart","ctrlKey","setStart","goToStart","adjustEnd","setEnd","goToEnd","msg","prompt","inputPrompt","getAbsoluteUrl","altKey","getUrl","applyUrlFragment","getUrlFragment","toggle","clipboardPrompt","message","def","createButton","clickFunction","abLoopCall","whichButton","which","updateText","updateTextFunction","defaultText","textFunction","text","el","textContent","b","controlBar","addChild","leftclick","on","rightclick","onmousedown","bind","preventDefault","stopPropagation","optionsUsed","addClass","createButtons","changedReducer","acc","buttonName","needsUpdate","reduce","resetToInitialOptions","enable","disable","togglePauseAfterLooping","togglePauseBeforeLooping","setup","ready","loop","loaded","VERSION","registerPlugin","plugin"],"mappings":"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","file":"videojs-abloop.js","sourceRoot":"..","sourcesContent":["/*\r\n * Video.js AB loop plugin\r\n * Adds function to allow looping for a section of a video in video.js player\r\n * https://github.com/phhu/videojs-abloop\r\n * MIT licence\r\n */\r\n\r\nexport default function (window, videojs) {\r\n\t\"use strict\";\r\n\r\n\tvar version = \"1.1.0\";\r\n\tvar abLoopPlugin = function (initialOptions) {\r\n\r\n\t\t//default initial options if not specified. \r\n\t\tinitialOptions = initialOptions || {};\r\n\t\t\r\n\t\t//get reference to player\r\n\t\tvar player = this;\r\n\r\n\t\t//utility functions\r\n\t\tvar isNumber = function (n) {\r\n\t\t\treturn !isNaN(parseFloat(n)) && isFinite(n);\r\n\t\t};\r\n\t\tvar isFunction = function (functionToCheck) {\r\n\t\t\tvar getType = {};\r\n\t\t\treturn functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';\r\n\t\t};\r\n\t\tvar toBoolean = function (x) {\r\n\t\t\treturn !!x;\r\n\t\t};\r\n\t\tvar cloneAndPluck = function (sourceObject, keys) {\r\n\t\t\tvar newObject = {};\r\n\t\t\tkeys.forEach(function (key) {\r\n\t\t\t\tif (sourceObject[key] !== undefined) {\r\n\t\t\t\t\tnewObject[key] = sourceObject[key];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn newObject;\r\n\t\t};\r\n\t\t//adds decimals to videojs's format time function\r\n\t\tvar formatTimeWithMS = function (seconds, decimalPlaces) {\r\n\t\t\tdecimalPlaces = decimalPlaces || 1;\r\n\t\t\treturn videojs.formatTime(seconds) + '.' + Math.floor((seconds % 1) * Math.pow(10, decimalPlaces));\r\n\t\t};\r\n\t\tvar roundFloat = function (n, decimalPlaces) {\r\n\t\t\tvar f = Math.pow(10, decimalPlaces);\r\n\t\t\treturn Math.floor(n * f) / f;\r\n\t\t};\r\n\r\n\t\t//this converts a timestamp (1h23, 1:23:33, 1m30s etc) to a number of seconds\r\n\t\tvar parseTimeStamp = function (timestamp) {\r\n\t\t\tif (timestamp === undefined) {\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t\t//if a plain number ,assume seconds\r\n\t\t\tif (isNumber(timestamp)) {\r\n\t\t\t\treturn timestamp;\r\n\t\t\t}\r\n\t\t\tif (/^([+\\-])?([\\d\\.]+)$/i.test(timestamp)) {\r\n\t\t\t\treturn parseFloat(timestamp);\r\n\t\t\t}\r\n\t\t\t//this assumes a plain whole number is minutes\r\n\t\t\tvar res = /^([+\\-])?((([\\d]+)(h|:(?=.*:)))?(([\\d]+)(m|:|$))?)?(([\\d\\.]+)s?)?$/i.exec(timestamp);\r\n\t\t\tif (!res) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tvar d = {\r\n\t\t\t\tmatch: res[0],\r\n\t\t\t\tsign: res[1],\r\n\t\t\t\thours: res[4] || 0,\r\n\t\t\t\tmins: res[7] || 0,\r\n\t\t\t\tsecs: res[10] || 0\r\n\t\t\t};\r\n\t\t\tvar multiplier = (d.sign == '-') ? -1 : 1;\r\n\t\t\tvar totSecs = parseFloat(d.hours) * 60 * 60 + parseFloat(d.mins) * 60 + parseFloat(d.secs);\r\n\t\t\treturn isNumber(totSecs) ? multiplier * totSecs : null;\r\n\t\t};\r\n\r\n\t\t//contains options, allowing them to be set at runtime\r\n\t\tvar opts = {};\r\n\r\n\t\tvar optionSpecs = {\r\n\t\t\t'start': {\r\n\t\t\t\t\"default\": 0,\r\n\t\t\t\t\"validate\": function (x) {\r\n\t\t\t\t\tif (x === false) {\r\n\t\t\t\t\t\treturn x;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (isNumber(x) && x >= 0) {\r\n\t\t\t\t\t\treturn x;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'end': {\r\n\t\t\t\t\"default\": false,\r\n\t\t\t\t\"validate\": function (x) {\r\n\t\t\t\t\tif (x === false) {\r\n\t\t\t\t\t\treturn x;\r\n\t\t\t\t\t} //allow false values to mean loop til end\r\n\t\t\t\t\tif (isNumber(x)) {\r\n\t\t\t\t\t\tvar duration = player.duration();\r\n\t\t\t\t\t\tif (duration === 0 || !(isNumber(duration))) { //duration unknown\r\n\t\t\t\t\t\t\tif (x >= 0) {\r\n\t\t\t\t\t\t\t\treturn x;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else { //we know the duration\r\n\t\t\t\t\t\t\tif (x >= 0 && x <= duration) {\r\n\t\t\t\t\t\t\t\treturn x;\r\n\t\t\t\t\t\t\t} else if (x > duration) {\r\n\t\t\t\t\t\t\t\treturn duration;\r\n\t\t\t\t\t\t\t} else {    // shouldn't happen....\r\n\t\t\t\t\t\t\t\treturn x;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false; // by default, loop to end of video\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'enabled': {\r\n\t\t\t\t\"default\": false,\r\n\t\t\t\t\"validate\": toBoolean\r\n\t\t\t},\r\n\t\t\t'loopIfBeforeStart': {\r\n\t\t\t\t\"default\": true,\r\n\t\t\t\t\"validate\": toBoolean\r\n\t\t\t},\r\n\t\t\t'loopIfAfterEnd': {\r\n\t\t\t\t\"default\": true,\r\n\t\t\t\t\"validate\": toBoolean\r\n\t\t\t},\r\n\t\t\t'pauseBeforeLooping': {\r\n\t\t\t\t\"default\": false,\r\n\t\t\t\t\"validate\": toBoolean\r\n\t\t\t},\r\n\t\t\t'pauseAfterLooping': {\r\n\t\t\t\t\"default\": false,\r\n\t\t\t\t\"validate\": toBoolean\r\n\t\t\t}\r\n\t\t\t//it's easier not to treat this as an option, as can't remove buttons once created\r\n\t\t\t/*,'createButtons':{\r\n\t\t\t\"default\":true\r\n\t\t,\"validate\":toBoolean\r\n\t\t\t}*/\r\n\t\t};\r\n\r\n\t\t//callbacks can be included in initial options, but are not treated as options\r\n\t\t//check is used to check that the callbacks are valid, but not to replace their values\r\n\t\tvar callBackSpecs = {\r\n\t\t\t'onLoopCallBack': {\r\n\t\t\t\t\"default\": undefined,\r\n\t\t\t\t\"check\": isFunction\r\n\t\t\t},\r\n\t\t\t'onOptionsChange': {\r\n\t\t\t\t\"default\": undefined,\r\n\t\t\t\t\"check\": isFunction\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t//for convenience\r\n\t\tvar optionNames = Object.keys(optionSpecs);\r\n\t\tvar callBackNames = Object.keys(callBackSpecs);\r\n\r\n\t\t//set initial option values to defaults if they are not specified\r\n\t\tvar defaultInitialOptions = function () {\r\n\t\t\tinitialOptions = initialOptions || {};\r\n\r\n\t\t\tvar setToDefault = function (specs) {\r\n\t\t\t\treturn function (name) {\r\n\t\t\t\t\tif (initialOptions[name] === undefined) {\r\n\t\t\t\t\t\tinitialOptions[name] = specs[name].default;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t\toptionNames.forEach(setToDefault(optionSpecs));\r\n\t\t\tcallBackNames.forEach(setToDefault(callBackSpecs));\r\n\t\t};\r\n\r\n\t\t//assign bound copies of the callbacks to the api\r\n\t\tvar setCallBacksToInitialOptions = function () {\r\n\t\t\tcallBackNames.forEach(function (callBackName) {\r\n\t\t\t\tif (callBackSpecs[callBackName].check(initialOptions[callBackName])) {\r\n\t\t\t\t\tapi[callBackName] = initialOptions[callBackName]; // .bind(api) - better not to bind\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t//check that the options make sense. This is called on timeupdate, before the main logic.\r\n\t\t//so nonsense options will persist as long as time does not update\r\n\t\tvar validateOptions = function () {\r\n\t\t\toptionNames.forEach(function (optName) {\r\n\t\t\t\topts[optName] = optionSpecs[optName].validate(opts[optName]);\r\n\t\t\t});\r\n\t\t\treturn api;\r\n\t\t};\r\n\r\n\t\tvar setOptionsToInitialOptions = function () {\r\n\t\t\treturn setOptions(initialOptions, true);\r\n\t\t};\r\n\r\n\t\tvar setOptions = function (newOptions, replaceAll) {\r\n\r\n\t\t\toptionNames.forEach(function (optName) {\r\n\t\t\t\tif (replaceAll || newOptions[optName] !== undefined) {\r\n\t\t\t\t\topts[optName] = newOptions[optName];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tvalidateOptions();\r\n\t\t\treturn api;\r\n\t\t};\r\n\r\n\t\tvar alreadyPausedBeforeLoop = false; //if we pause before looping, need to know if it has already been done so that we can then loop\r\n\t\t//this sets the player to the start of the loop\r\n\t\tvar goToStartOfLoop = function (checkPause) {\r\n\r\n\t\t\tif (checkPause) {\r\n\t\t\t\tif (opts.pauseBeforeLooping && alreadyPausedBeforeLoop === false) {\r\n\t\t\t\t\tplayer.pause();\r\n\t\t\t\t\talreadyPausedBeforeLoop = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\talreadyPausedBeforeLoop = false;\r\n\r\n\t\t\t\t\t//do loop\r\n\t\t\t\t\tplayer.currentTime(opts.start);\r\n\t\t\t\t\t//invoke callback if set\r\n\t\t\t\t\tif (opts.pauseAfterLooping) {\r\n\t\t\t\t\t\tplayer.pause();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (callBackSpecs.onLoopCallBack.check(api.onLoopCallBack)) {\r\n\t\t\t\t\t\tapi.onLoopCallBack(api, player);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\talreadyPausedBeforeLoop = false;\r\n\t\t\t\tplayer.currentTime(opts.start);\r\n\t\t\t}\r\n\t\t\treturn api;\r\n\t\t};\r\n\r\n\t\tvar goToEndOfLoop = function () {\r\n\t\t\talreadyPausedBeforeLoop = false;\r\n\t\t\tplayer.currentTime(opts.end);\r\n\t\t\treturn api;\r\n\t\t};\r\n\r\n\t\t//makes a function to set a time option (start,end)\r\n\t\tvar timeSetter = function (optName) {\r\n\t\t\treturn function (time) {\r\n\t\t\t\tif (time === false) {\r\n\t\t\t\t\topts[optName] = false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (time !== undefined) {\r\n\t\t\t\t\t\ttime = parseTimeStamp(time);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (time !== null) {\r\n\t\t\t\t\t\ttime = (time === undefined) ? player.currentTime() : time;\r\n\t\t\t\t\t\topts[optName] = time;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn api;\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\t//makes a function to change a time option\r\n\t\tvar timeAdjuster = function (optName) {\r\n\t\t\treturn function (adjustment) {\r\n\t\t\t\tadjustment = parseTimeStamp(adjustment);\r\n\t\t\t\tif (isNumber(adjustment)) {\r\n\t\t\t\t\topts[optName] += adjustment;\r\n\t\t\t\t}\r\n\t\t\t\treturn api;\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tvar playLoop = function () {\r\n\t\t\tvalidateOptions();\r\n\t\t\tgoToStartOfLoop(false);\r\n\t\t\tenableLoop();\r\n\t\t\tplayer.play();\r\n\t\t\treturn api;\r\n\t\t};\r\n\r\n\t\tvar enableLoop = function () {\r\n\t\t\topts.enabled = true;\r\n\t\t\treturn api;\r\n\t\t};\r\n\t\tvar disableLoop = function () {\r\n\t\t\topts.enabled = false;\r\n\t\t\treturn api;\r\n\t\t};\r\n\t\tvar cyclePauseOnLooping = function () {\r\n\t\t\tvar after = opts.pauseAfterLooping,\r\n\t\t\tbefore = opts.pauseBeforeLooping;\r\n\t\t\tif (!after && !before) {\r\n\t\t\t\tsetOptions({\r\n\t\t\t\t\tpauseAfterLooping: true,\r\n\t\t\t\t\tpauseBeforeLooping: false\r\n\t\t\t\t});\r\n\t\t\t} else if (after && !before) {\r\n\t\t\t\tsetOptions({\r\n\t\t\t\t\tpauseAfterLooping: false,\r\n\t\t\t\t\tpauseBeforeLooping: true\r\n\t\t\t\t});\r\n\t\t\t} else if (!after && before) {\r\n\t\t\t\tsetOptions({\r\n\t\t\t\t\tpauseAfterLooping: true,\r\n\t\t\t\t\tpauseBeforeLooping: true\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tsetOptions({\r\n\t\t\t\t\tpauseAfterLooping: false,\r\n\t\t\t\t\tpauseBeforeLooping: false\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn api;\r\n\t\t};\r\n\r\n\t\t//return a function to toggle an option\r\n\t\tvar toggler = function (optName) {\r\n\t\t\treturn function () {\r\n\t\t\t\topts[optName] = !opts[optName];\r\n\t\t\t\treturn api;\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\t//borrowed from videojs library (private method)\r\n\t\tvar absoluteURL = function (url) {\r\n\t\t\t// Check if absolute URL\r\n\t\t\tif (!url.match(/^https?:\\/\\//)) {\r\n\t\t\t\t// Convert to absolute URL.\r\n\t\t\t\tif (window && window.document) {\r\n\t\t\t\t\tvar div = window.document.createElement('div');\r\n\t\t\t\t\tdiv.innerHTML = '<a href=\"' + url + '\">x</a>';\r\n\t\t\t\t\turl = div.firstChild.href;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn url;\r\n\t\t};\r\n\r\n\t\tvar getAbsoluteUrlWithHash = function (spec) {\r\n\t\t\treturn absoluteURL(getUrlWithHash(spec));\r\n\t\t};\r\n\r\n\t\t//return a URL hash / fragment describing the looped portion.\r\n\t\t//e.g. #t=10,12  - see https://www.w3.org/TR/media-frags/#standardisation-URI-fragments\r\n\t\tvar getUrlHash = function (spec) {\r\n\t\t\tspec = spec || {};\r\n\t\t\tspec.decimalPlaces = Math.floor(spec.decimalPlaces) || 3;\r\n\r\n\t\t\t//validateOptions();\r\n\r\n\t\t\tvar start = (opts.start !== false) ? parseFloat(opts.start) : 0;\r\n\t\t\tvar hash = '#' + 't=' + roundFloat(start, spec.decimalPlaces);\r\n\r\n\t\t\tif (opts.end !== false) {\r\n\t\t\t\tvar end = parseFloat(opts.end);\r\n\t\t\t\thash += (',' + roundFloat(end, spec.decimalPlaces));\r\n\t\t\t}\r\n\t\t\treturn hash;\r\n\r\n\t\t};\r\n\r\n\t\t//get a URL with a hash to identify the looping section\r\n\t\tvar getUrlWithHash = function (spec) {\r\n\t\t\tspec = spec || {};\r\n\r\n\t\t\tvar src = player.currentSrc();\r\n\t\t\tif (src.src) {\r\n\t\t\t\tsrc = src.src;\r\n\t\t\t}\r\n\t\t\tvar url = src + getUrlHash(spec);\r\n\r\n\t\t\treturn url;\r\n\r\n\t\t};\r\n\t\t//apply just a hash, effectively setting start and end options\r\n\t\tvar applyUrlHash = function (url) {\r\n\r\n\t\t\t//allow to pass in a string or an object with hash property\r\n\t\t\tif (typeof url === 'string') {\r\n\t\t\t\turl = videojs.parseUrl(url);\r\n\t\t\t}\r\n\t\t\tif (url.hash) {\r\n\t\t\t\t//extract out the start and end times\r\n\t\t\t\tvar re = /^(#?t=)?([^,]*)(,(.*))?$/;\r\n\t\t\t\tvar start = url.hash.replace(re, '$2');\r\n\t\t\t\tvar end = url.hash.replace(re, '$4');\r\n\r\n\t\t\t\t//normally only seconds or hh:mm:ss are allowed, but allow 1m20s etc\r\n\t\t\t\tstart = parseTimeStamp(start);\r\n\t\t\t\tend = parseTimeStamp(end);\r\n\r\n\t\t\t\tif (isNumber(start)) {\r\n\t\t\t\t\topts.start = parseFloat(start);\r\n\t\t\t\t}\r\n\t\t\t\tif (isNumber(end)) {\r\n\t\t\t\t\topts.end = parseFloat(end);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn api;\r\n\t\t};\r\n\t\t//apply a url, typically with a hash to identify a section to loop\r\n\t\t//this will load a new source if necessary\r\n\t\tvar applyUrl = function (url) {\r\n\r\n\t\t\t//could use videojs.parseUrl, but regexping is less hassle\r\n\t\t\tvar urlWithoutHash = url.replace(/^(.*?)(#.*)?$/, '$1');\r\n\t\t\tvar urlHash = url.replace(/^(.*?)(#.*)?$/, '$2');\r\n\r\n\t\t\t//check if we need to update the source\r\n\t\t\tvar curSrc = player.currentSrc();\r\n\t\t\tif (!(curSrc == urlWithoutHash || curSrc == url || url == urlHash)) {\r\n\t\t\t\tplayer.src(urlWithoutHash);\r\n\t\t\t}\r\n\t\t\t//apply hash if there is one\r\n\t\t\tif (urlHash) {\r\n\t\t\t\tapplyUrlHash(urlHash);\r\n\t\t\t}\r\n\r\n\t\t\treturn api;\r\n\r\n\t\t};\r\n\r\n\t\tvar getOptions = function (optionsToReturn) {\r\n\r\n\t\t\tvar retOpts = optionsToReturn;\r\n\r\n\t\t\t//coerce retOpts into an Array\r\n\t\t\tif (typeof optionsToReturn === 'string') {\r\n\t\t\t\tretOpts = [optionsToReturn];\r\n\t\t\t} else if (optionsToReturn === undefined || !Array.isArray(optionsToReturn)) {\r\n\t\t\t\tif (optionsToReturn !== null && typeof optionsToReturn === 'object') {\r\n\t\t\t\t\t//allow specification with an object`\r\n\t\t\t\t\tretOpts = Object.keys(optionsToReturn);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//return all options if none are specified\r\n\t\t\t\t\tretOpts = Object.keys(optionSpecs);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn cloneAndPluck(opts, retOpts);\r\n\r\n\t\t};\r\n\r\n\t\t//used to add notification to a function call\r\n\t\t//changed is an object of properties which have changed\r\n\t\t//e.g. {'start':true, 'end':false}\r\n\t\tvar notify = function (funcToRun, changed) {\r\n\t\t\tvar defValue = changed ? false : true; //if changed not specified, assume they all have\r\n\t\t\tchanged = changed || {};\r\n\r\n\t\t\t//set defaults for changed\r\n\t\t\toptionNames.forEach(function (optName) {\r\n\t\t\t\tchanged[optName] = !!changed[optName] || defValue;\r\n\t\t\t});\r\n\r\n\t\t\treturn function () {\r\n\t\t\t\tvar args = arguments;\r\n\t\t\t\tvar oldOpts = getOptions(); //copy options as were\r\n\t\t\t\tvar ret = funcToRun.apply(null, args);\r\n\t\t\t\tvar optionDetails = {\r\n\t\t\t\t\t'changed': changed,\r\n\t\t\t\t\t'oldOpts': oldOpts,\r\n\t\t\t\t\t'newOpts': getOptions()\r\n\t\t\t\t};\r\n\t\t\t\tif (api.onOptionsChange) {\r\n\t\t\t\t\tapi.onOptionsChange(optionDetails, api, player);\r\n\t\t\t\t}\r\n\t\t\t\tupdateButtonText(changed); //API might have changed settings, so update the buttons\r\n\t\t\t\treturn ret;\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tvar loopAtEndOfVideoRequired = false; //flag set to true if looping around end of video is requierd (where start > end)\r\n\t\tvar startMargin = 0.5; //sometimes the video will go to a point just before the loop (rounding), so allow a small margin on the start position check.\r\n\t\tvar endMargin = 1; //sometimes the video will go to a point just before the loop (rounding), so allow a small margin on the start position check.\r\n\t\t//given the current player state and options, should we loop?\r\n\t\tvar loopRequired = function () {\r\n\t\t\tvar curTime,\r\n\t\t\tendTime,\r\n\t\t\tstartTime;\r\n\r\n\t\t\tvalidateOptions();\r\n\r\n\t\t\tcurTime = player.currentTime();\r\n\t\t\tendTime = getEndTime();\r\n\t\t\tstartTime = getStartTime();\r\n\r\n\t\t\tif (startTime > endTime) {\r\n\t\t\t\tloopAtEndOfVideoRequired = true;\r\n\t\t\t\t//if the end is before the start, deal with it\r\n\t\t\t\tif (curTime < (startTime - startMargin) && curTime > endTime && ((curTime - endTime) < endMargin || opts.loopIfAfterEnd || opts.loopIfBeforeStart)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t} else { //startTime <= endTime\r\n\t\t\t\tloopAtEndOfVideoRequired = false;\r\n\t\t\t\tif (curTime < (startTime - startMargin) && opts.loopIfBeforeStart) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else if (curTime >= endTime) {\r\n\t\t\t\t\t//use a margin of one just in case time has skipped a bit past\r\n\t\t\t\t\tif ((curTime - endTime) < endMargin || opts.loopIfAfterEnd) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t};\r\n\r\n\t\tvar getStartTime = function () {\r\n\t\t\treturn (opts.start === false) ? 0 : opts.start;\r\n\t\t};\r\n\t\tvar getEndTime = function () {\r\n\t\t\treturn (opts.end === false) ? player.duration() : opts.end;\r\n\t\t};\r\n\t\tvar isLooping = false;\r\n\t\tvar minLoopLength = (isNumber(initialOptions.minLoopLength) && initialOptions.minLoopLength > 0) ? initialOptions.minLoopLength : 200;\r\n\t\t//function run on time update by player\r\n\t\tvar checkABLoop = function (e) {\r\n\t\t\tif (!isLooping && opts.enabled && !player.paused() && loopRequired()) {\r\n\t\t\t\t//prevents constant looping\r\n\t\t\t\t/*if (getStartTime() === getEndTime()){\r\n\t\t\t\tplayer.pause();\r\n\t\t\t\t}*/\r\n\t\t\t\t//prevent looping happening to quickly in succession\r\n\t\t\t\t//this effectively sets a minimum loop time\r\n\t\t\t\t//if start time and end time are the same, we would get a loop of this length\r\n\t\t\t\tisLooping = true;\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tisLooping = false;\r\n\t\t\t\t}, minLoopLength);\r\n\t\t\t\tgoToStartOfLoop(true);\r\n\t\t\t}\r\n\t\t};\r\n\t\t// BUTTON THINGS\r\n\t\tvar buttons = {}; //holds references to the button objects\r\n\r\n\t\tvar buttonSpecs = [{\r\n\t\t\t\t'name': 'start',\r\n\t\t\t\t'optionsUsed': ['start'],\r\n\t\t\t\t'leftclick': function (api, event) {\r\n\t\t\t\t\tif (event.shiftKey) {\r\n\t\t\t\t\t\tapi.adjustStart(-0.5);\r\n\t\t\t\t\t} else if (event.ctrlKey) {\r\n\t\t\t\t\t\tapi.adjustStart(-0.05);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapi.setStart();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'rightclick': function (api, event) {\r\n\t\t\t\t\tif (event.shiftKey) {\r\n\t\t\t\t\t\tapi.adjustStart(0.5);\r\n\t\t\t\t\t} else if (event.ctrlKey) {\r\n\t\t\t\t\t\tapi.adjustStart(0.05);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapi.goToStart();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'defaultText': 'Start',\r\n\t\t\t\t'textFunction': function (opts) {\r\n\t\t\t\t\treturn formatTimeWithMS(opts.start);\r\n\t\t\t\t}\r\n\t\t\t}, {\r\n\t\t\t\t'name': 'end',\r\n\t\t\t\t'optionsUsed': ['end'],\r\n\t\t\t\t'leftclick': function (api, event) {\r\n\t\t\t\t\tif (event.shiftKey) {\r\n\t\t\t\t\t\tapi.adjustEnd(-0.5);\r\n\t\t\t\t\t} else if (event.ctrlKey) {\r\n\t\t\t\t\t\tapi.adjustEnd(-0.05);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapi.setEnd();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'rightclick': function (api, event) {\r\n\t\t\t\t\tif (event.shiftKey) {\r\n\t\t\t\t\t\tapi.adjustEnd(0.5);\r\n\t\t\t\t\t} else if (event.ctrlKey) {\r\n\t\t\t\t\t\tapi.adjustEnd(0.05);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapi.goToEnd();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'defaultText': 'End',\r\n\t\t\t\t'textFunction': function (opts) {\r\n\t\t\t\t\treturn formatTimeWithMS(opts.end);\r\n\t\t\t\t}\r\n\t\t\t}, {\r\n\t\t\t\t'name': 'enabled',\r\n\t\t\t\t'optionsUsed': ['enabled', 'pauseAfterLooping', 'pauseBeforeLooping'],\r\n\t\t\t\t'leftclick': function (api, event) {\r\n\t\t\t\t\tvar msg,\r\n\t\t\t\t\turl;\r\n\t\t\t\t\tif (window && window.prompt) {\r\n\t\t\t\t\t\tif (event.ctrlKey) {\r\n\t\t\t\t\t\t\tapi.applyUrl(inputPrompt(\"Set new URL\", api.getAbsoluteUrl()));\r\n\t\t\t\t\t\t} else if (event.altKey) {\r\n\t\t\t\t\t\t\tapi.applyUrl(inputPrompt(\"Set new URL\", api.getUrl()));\r\n\t\t\t\t\t\t} else if (event.shiftKey) {\r\n\t\t\t\t\t\t\tapi.applyUrlFragment(inputPrompt(\"Set new URL fragment\", api.getUrlFragment()));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tapi.toggle();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapi.toggle();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'rightclick': function (api, event) {\r\n\t\t\t\t\tvar msg;\r\n\t\t\t\t\tif (window && window.prompt) {\r\n\t\t\t\t\t\tif (event.ctrlKey) {\r\n\t\t\t\t\t\t\tmsg = api.getAbsoluteUrl();\r\n\t\t\t\t\t\t} else if (event.altKey) {\r\n\t\t\t\t\t\t\tmsg = api.getUrl();\r\n\t\t\t\t\t\t} else if (event.shiftKey) {\r\n\t\t\t\t\t\t\tmsg = api.getUrlFragment();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (msg) {\r\n\t\t\t\t\t\tclipboardPrompt(msg);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapi.cyclePauseOnLooping();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'defaultText': 'Loop',\r\n\t\t\t\t'textFunction': function (opts) {\r\n\t\t\t\t\tif (opts.enabled) {\r\n\t\t\t\t\t\tif (opts.pauseBeforeLooping && opts.pauseAfterLooping) {\r\n\t\t\t\t\t\t\treturn 'PAUSE LOOP PAUSE';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (opts.pauseAfterLooping) {\r\n\t\t\t\t\t\t\treturn 'LOOP& PAUSE';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (opts.pauseBeforeLooping) {\r\n\t\t\t\t\t\t\treturn 'PAUSE &LOOP';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn 'LOOP ON';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn 'Loop off';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t];\r\n\t\tvar clipboardPrompt = function (msg) {\r\n\t\t\tif (window && window.prompt) {\r\n\t\t\t\twindow.prompt(\"Copy to clipboard: Ctrl+C, Enter\", msg);\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar inputPrompt = function (message, def) {\r\n\t\t\tif (window && window.prompt) {\r\n\t\t\t\treturn window.prompt(message, def);\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar createButton = function (spec, player) {\r\n\t\t\t//returns a function which handles button clicks,\r\n\t\t\tvar clickFunction = function (abLoopCall, whichButton) {\r\n\t\t\t\treturn function (event) {\r\n\t\t\t\t\tif (whichButton === undefined || (event.which && event.which == whichButton)) {\r\n\t\t\t\t\t\tabLoopCall(player.abLoopPlugin, event);\r\n\t\t\t\t\t\tthis.updateText();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t};\r\n\r\n\t\t\t//returns a function which handles button text updates\r\n\t\t\tvar updateTextFunction = function (defaultText, textFunction) {\r\n\t\t\t\treturn function () {\r\n\t\t\t\t\tvar text = textFunction(opts) || defaultText;\r\n\t\t\t\t\tvar el = this.el();\r\n\t\t\t\t\tel.textContent = text;\r\n\t\t\t\t\t//el.innerText = text;    //doesn't work in Firefox\r\n\t\t\t\t};\r\n\t\t\t};\r\n\r\n\t\t\t//create the button\r\n\t\t\tvar b = player.controlBar.addChild('Button');\r\n\t\t\tif (spec.leftclick) {\r\n\t\t\t\tb.on('click', clickFunction(spec.leftclick));\r\n\t\t\t}\r\n\t\t\tif (spec.rightclick) {\r\n\t\t\t\t//event which\r\n\t\t\t\t//bind the function as it isn't bound by default\r\n\t\t\t\tb.el().onmousedown = clickFunction(spec.rightclick, 3).bind(b);\r\n\t\t\t\t//knock out the context menu\r\n\t\t\t\tb.on('contextmenu', function (event) {\r\n\t\t\t\t\tif (event.preventDefault) {\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (event.preventDefault) {\r\n\t\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t//gets called when text on button needs updating\r\n\t\t\tb.updateText = updateTextFunction(spec.defaultText, spec.textFunction);\r\n\t\t\tb.optionsUsed = spec.optionsUsed;\r\n\t\t\tb.addClass('abLoopButton');\r\n\t\t\tb.addClass(spec.name);\r\n\t\t\tb.updateText(); //set the initial text\r\n\t\t\treturn b;\r\n\t\t};\r\n\r\n\t\t//create the buttons based on the specs\r\n\t\tvar createButtons = function (specs) {\r\n\t\t\tspecs.forEach(function (spec) {\r\n\t\t\t\t//only create the button if it's not already there\r\n\t\t\t\tif (buttons[spec.name] === undefined) {\r\n\t\t\t\t\tbuttons[spec.name] = createButton(spec, player);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t//updates button displays if not already done\r\n\t\tvar updateButtonText = function (changed) {\r\n\t\t\tvar changedReducer = function (acc, optName) {\r\n\t\t\t\treturn acc || changed[optName];\r\n\t\t\t};\r\n\t\t\tfor (var buttonName in buttons) {\r\n\t\t\t\tvar b = buttons[buttonName];\r\n\t\t\t\tvar needsUpdate = !(b.optionsUsed) || b.optionsUsed.reduce(changedReducer, false);\r\n\t\t\t\tif (needsUpdate) {\r\n\t\t\t\t\tb.updateText();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t//functions etc to expose as API\r\n\t\t//those which change values can be passed through the notify function\r\n\t\tvar api = {\r\n\t\t\tvalidateOptions: notify(validateOptions),\r\n\t\t\tresetToInitialOptions: notify(setOptionsToInitialOptions),\r\n\t\t\tsetOptions: notify(setOptions),\r\n\t\t\tgetOptions: getOptions,\r\n\t\t\tgoToStart: goToStartOfLoop,\r\n\t\t\tgoToEnd: goToEndOfLoop,\r\n\t\t\tsetStart: notify(timeSetter('start'), {\r\n\t\t\t\t'start': true\r\n\t\t\t}),\r\n\t\t\tsetEnd: notify(timeSetter('end'), {\r\n\t\t\t\t'end': true\r\n\t\t\t}),\r\n\t\t\tadjustStart: notify(timeAdjuster('start'), {\r\n\t\t\t\t'start': true\r\n\t\t\t}),\r\n\t\t\tadjustEnd: notify(timeAdjuster('end'), {\r\n\t\t\t\t'end': true\r\n\t\t\t}),\r\n\t\t\tenable: notify(enableLoop, {\r\n\t\t\t\t'enabled': true\r\n\t\t\t}),\r\n\t\t\tdisable: notify(disableLoop, {\r\n\t\t\t\t'enabled': true\r\n\t\t\t}),\r\n\t\t\ttoggle: notify(toggler('enabled'), {\r\n\t\t\t\t'enabled': true\r\n\t\t\t}),\r\n\t\t\ttogglePauseAfterLooping: notify(toggler('pauseAfterLooping'), {\r\n\t\t\t\t'pauseAfterLooping': true\r\n\t\t\t}),\r\n\t\t\ttogglePauseBeforeLooping: notify(toggler('pauseBeforeLooping'), {\r\n\t\t\t\t'pauseBeforeLooping': true\r\n\t\t\t}),\r\n\t\t\tcyclePauseOnLooping: notify(cyclePauseOnLooping, {\r\n\t\t\t\t'pauseBeforeLooping': true,\r\n\t\t\t\t'pauseAfterLooping': true\r\n\t\t\t}),\r\n\t\t\tplayer: player,\r\n\t\t\tversion: version,\r\n\t\t\tgetAbsoluteUrl: getAbsoluteUrlWithHash,\r\n\t\t\tgetUrl: getUrlWithHash,\r\n\t\t\tgetUrlFragment: getUrlHash,\r\n\t\t\tapplyUrl: notify(applyUrl, {\r\n\t\t\t\t'start': true,\r\n\t\t\t\t'end': true\r\n\t\t\t}),\r\n\t\t\tapplyUrlFragment: notify(applyUrlHash, {\r\n\t\t\t\t'start': true,\r\n\t\t\t\t'end': true\r\n\t\t\t}),\r\n\t\t\tloopRequired: loopRequired //allows testing of conditions via API when player is paused\r\n\t\t,\r\n\t\t\tplayLoop: notify(playLoop)\r\n\t\t};\r\n\r\n\t\t//set up the plugin\r\n\t\tvar setup = function () {\r\n\r\n\t\t\tdefaultInitialOptions();\r\n\r\n\t\t\tsetCallBacksToInitialOptions();\r\n\r\n\t\t\t//set options to initial options and notify of change\r\n\t\t\tnotify(setOptionsToInitialOptions)();\r\n\r\n\t\t\tplayer.ready(function () {\r\n\t\t\t\t//create buttons once the player is ready\r\n\t\t\t\tif (initialOptions.createButtons != false) {\r\n\t\t\t\t\tcreateButtons(buttonSpecs);\r\n\t\t\t\t}\r\n\t\t\t\t//if start time is greater than end, the video needs to loop on ending\r\n\t\t\t\t//this is indicated by the loopAtEndOfVideoRequired flag\r\n\t\t\t\tplayer.on('ended', function () {\r\n\t\t\t\t\tif (loopAtEndOfVideoRequired && opts.enabled && !player.loop()) {\r\n\t\t\t\t\t\tplayer.play();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t//this replaces the reference created to this function on each player object\r\n\t\t\t//with a reference to the api object (created once per invocation of this function)\r\n\t\t\t//The functions created in this function and referenced by api will still\r\n\t\t\t//be available via closure\r\n\t\t\tplayer.abLoopPlugin = api;\r\n\r\n\t\t\t//on timeupdate, check if we need to loop\r\n\t\t\tplayer.on('timeupdate', checkABLoop);\r\n\t\t\tapi.loaded = true;\r\n\t\t};\r\n\r\n\t\tsetup();\r\n\t\treturn api;\r\n\t};\r\n\r\n\tabLoopPlugin.loaded = false;\r\n\tabLoopPlugin.VERSION = version;\r\n\r\n\tvar registerPlugin = videojs.registerPlugin || videojs.plugin;\r\n\treturn registerPlugin('abLoopPlugin', abLoopPlugin);\r\n\r\n};\r\n","// this file used to build the file for distribution \r\n// and so use directly in the browser\r\n\r\n// videojs is an external dependency - see package.json\r\n//import videojs from 'video.js' \r\nimport abLoopPlugin from './videojs-abloop'   \r\n\r\nabLoopPlugin(window,videojs);\r\n"]}